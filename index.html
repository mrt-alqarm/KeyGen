<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مولد المفاتيح العشوائية</title>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; font-src https://cdnjs.cloudflare.com;">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer">
    <script>
        // تعيين اتجاه الصفحة بناءً على اللغة المحفوظة
        const savedLang = localStorage.getItem('selectedLang') || 'ar';
        document.documentElement.setAttribute('dir', (savedLang === 'ar' || savedLang === 'fa') ? 'rtl' : 'ltr');
        document.documentElement.setAttribute('lang', savedLang);
    </script>
    <style>
        .container { position: relative; }
        .header-controls .language-icon { margin-right: 10px; color: #3498db; font-size: 18px; }
        .security-guide-btn { background: transparent !important; box-shadow: none !important; position: absolute; top: 20px; color: #27ae60 !important; }
        .security-guide-btn:hover { color: #2ecc71 !important; }
    </style>
    <style>*{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}body{background:linear-gradient(135deg,#6a11cb 0%,#2575fc 100%);color:#333;line-height:1.6;padding:20px;min-height:100vh;display:flex;justify-content:center;align-items:center}.container{max-width:800px;width:100%;margin:0 auto;background-color:rgba(255,255,255,.95);padding:30px;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,.2)}h1{text-align:center;margin-bottom:30px;color:#2c3e50;font-size:2.2rem;position:relative;padding-bottom:15px}h1::after{content:'';position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:100px;height:4px;background:linear-gradient(90deg,#6a11cb,#2575fc);border-radius:2px}.form-group{margin-bottom:20px}label{display:block;margin-bottom:8px;font-weight:bold;color:#2c3e50}input[type="number"]{width:100%;padding:12px 15px;border:2px solid #ddd;border-radius:6px;font-size:16px;transition:border-color .3s}input[type="number"]:focus{border-color:#3498db;outline:none}.checkbox-group{margin:12px 0;display:flex;align-items:center}.checkbox-group input[type="checkbox"]{margin-left:10px;width:18px;height:18px;cursor:pointer}.checkbox-group label{display:inline-block;margin-bottom:0;font-weight:normal;cursor:pointer}button{display:block;width:100%;padding:14px;background:linear-gradient(90deg,#3498db,#2980b9);color:white;border:none;border-radius:6px;cursor:pointer;font-size:18px;margin:25px 0;transition:transform .3s,box-shadow .3s;box-shadow:0 4px 10px rgba(52,152,219,.3)}button:hover{transform:translateY(-2px);box-shadow:0 6px 15px rgba(52,152,219,.4)}button:active{transform:translateY(0)}.result{margin-top:25px;padding:20px;background-color:#f8f9fa;border:2px solid #ddd;border-radius:8px;text-align:center;font-size:20px;word-break:break-all;position:relative;font-family:'Courier New',monospace;min-height:80px;display:flex;align-items:center;justify-content:center}.copy-btn{position:absolute;left:15px;top:50%;transform:translateY(-50%);background:linear-gradient(90deg,#7f8c8d,#95a5a6);padding:8px 15px;font-size:14px;width:auto;border-radius:6px;box-shadow:0 2px 5px rgba(0,0,0,.1)}.copy-btn:hover{background:linear-gradient(90deg,#95a5a6,#bdc3c7)}.strength-meter{height:12px;border-radius:6px;margin-top:15px;background-color:#eee;overflow:hidden}.strength-fill{height:100%;border-radius:6px;width:0%;transition:width .5s ease-in-out}.info{margin-top:10px;font-size:14px;color:#7f8c8d;text-align:center}.notification{position:fixed;top:20px;left:50%;transform:translateX(-50%);background-color:#2ecc71;color:white;padding:15px 25px;border-radius:8px;box-shadow:0 5px 15px rgba(0,0,0,.2);opacity:0;transition:opacity .3s,top .3s;z-index:1000;display:flex;align-items:center}.notification.error{background-color:#e74c3c}.notification.show{opacity:1;top:30px}.notification i{margin-left:10px}.auto-copy{display:flex;align-items:center;margin-top:10px}.auto-copy input{margin-left:10px}@media (max-width:600px){.container{padding:20px}h1{font-size:1.8rem}.result{font-size:16px;padding:15px 15px 15px 60px}.copy-btn{left:10px;padding:6px 12px;font-size:12px}.notification{width:90%;text-align:center}}</style>
</head>
<body>
    <div class="container">
        <div class="header-controls">
            <i class="fas fa-globe language-icon"></i>
            <select id="language-select">
                <option value="ar">العربية</option>
                <option value="fa">فارسی</option>
                <option value="en">English</option>
                <option value="fr">Français</option>
                <option value="zh">中文</option>
                <option value="ru">Русский</option>
            </select>
        </div>
        <a href="security-guide.html" class="security-guide-btn" data-i18n-title="securityGuideTitle">
            <i class="fas fa-shield-alt"></i>
        </a>
        <h1 id="title" data-i18n="title"></h1>
        <div class="form-group"><label for="length" id="lengthLabel" data-i18n="lengthLabel"></label><input type="number" id="length" min="4" max="512" value="16"></div><div class="form-group"><label id="charTypesLabel" data-i18n="charTypesLabel"></label><div class="checkbox-group"><input type="checkbox" id="uppercase" checked><label for="uppercase" id="uppercaseLabel" data-i18n="uppercaseLabel"></label></div><div class="checkbox-group"><input type="checkbox" id="lowercase" checked><label for="lowercase" id="lowercaseLabel" data-i18n="lowercaseLabel"></label></div><div class="checkbox-group"><input type="checkbox" id="numbers" checked><label for="numbers" id="numbersLabel" data-i18n="numbersLabel"></label></div><div class="checkbox-group"><input type="checkbox" id="symbols"><label for="symbols" id="symbolsLabel" data-i18n="symbolsLabel"></label></div></div><div class="auto-copy"><input type="checkbox" id="auto-copy" checked><label for="auto-copy" id="autoCopyLabel" data-i18n="autoCopyLabel"></label></div><button id="generate"><i class="fas fa-key"></i> <span id="generateBtn" data-i18n="generateBtn"></span></button><div class="result"><span id="key" data-i18n="keyPlaceholder"></span><button class="copy-btn" id="copy"><i class="fas fa-copy"></i> <span id="copyBtn" data-i18n="copyBtn"></span></button></div><div class="strength-meter"><div class="strength-fill" id="strength"></div></div><div class="info" id="strength-info" data-i18n="strengthInfo"></div>
    </div>

    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i> تم نسخ المفتاح بنجاح!
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const generateBtn = document.getElementById('generate');
            const copyBtn = document.getElementById('copy');
            const keyElement = document.getElementById('key');
            const lengthInput = document.getElementById('length');
            const uppercaseCheckbox = document.getElementById('uppercase');
            const lowercaseCheckbox = document.getElementById('lowercase');
            const numbersCheckbox = document.getElementById('numbers');
            const symbolsCheckbox = document.getElementById('symbols');
            const strengthElement = document.getElementById('strength');
            const strengthInfoElement = document.getElementById('strength-info');
            const notification = document.getElementById('notification');
            const autoCopyCheckbox = document.getElementById('auto-copy');
            const languageSelect = document.getElementById('language-select');

            let translations = {};
            let currentLang = localStorage.getItem('selectedLang') || 'ar'; // قراءة اللغة المحفوظة أو الافتراضية

            // تضمين ملفات الترجمة مباشرة
            const translationFiles = {
                ar: {
                    "title": "مولد المفاتيح العشوائية",
                    "lengthLabel": "طول المفتاح:",
                    "uppercaseLabel": "أحرف كبيرة (A-Z)",
                    "lowercaseLabel": "أحرف صغيرة (a-z)",
                    "numbersLabel": "أرقام (0-9)",
                    "symbolsLabel": "رموز خاصة (!@#$%^&*_+-=`:.?)",
                    "autoCopyLabel": "النسخ التلقائي للمفتاح بعد التوليد",
                    "generateBtn": "توليد مفتاح",
                    "copyBtn": "نسخ",
                    "keyPlaceholder": "سيظهر المفتاح هنا",
                    "strengthInfo": "قوة المفتاح: غير معروف",
                    "strengthWeak": "قوة المفتاح: ضعيف",
                    "strengthMedium": "قوة المفتاح: متوسط",
                    "strengthGood": "قوة المفتاح: جيد",
                    "strengthExcellent": "قوة المفتاح: ممتاز",
                    "notificationSuccess": "تم نسخ المفتاح بنجاح!",
                    "errorNoChars": "الرجاء اختيار نوع واحد على الأقل من الأحرف",
                    "errorLength": "الطول يجب أن يكون بين 4 و 512 حرفاً",
                    "errorNoKey": "لا يوجد مفتاح لنسخه",
                    "errorCopyFail": "فشل في نسخ المفتاح",
                    "languageSelect": "اختر اللغة",
                    "securityGuideTitle": "دليل الأمان الرقمي"
                },
                fa: {
                    "title": "تولید کننده کلیدهای تصادفی",
                    "lengthLabel": "طول کلید:",
                    "uppercaseLabel": "حروف بزرگ (A-Z)",
                    "lowercaseLabel": "حروف کوچک (a-z)",
                    "numbersLabel": "اعداد (0-9)",
                    "symbolsLabel": "نمادهای خاص (!@#$%^&*_+-=`:.?)",
                    "autoCopyLabel": "کپی خودکار کلید پس از تولید",
                    "generateBtn": "تولید کلید",
                    "copyBtn": "کپی",
                    "keyPlaceholder": "کلید اینجا نمایش داده می‌شود",
                    "strengthInfo": "قدرت کلید: نامشخص",
                    "strengthWeak": "قدرت کلید: ضعیف",
                    "strengthMedium": "قدرت کلید: متوسط",
                    "strengthGood": "قدرت کلید: خوب",
                    "strengthExcellent": "قدرت کلید: عالی",
                    "notificationSuccess": "کلید با موفقیت کپی شد!",
                    "errorNoChars": "لطفاً حداقل یک نوع کاراکتر انتخاب کنید",
                    "errorLength": "طول باید بین 4 تا 512 کاراکتر باشد",
                    "errorNoKey": "کلیدی برای کپی وجود ندارد",
                    "errorCopyFail": "کپی کلید ناموفق بود",
                    "languageSelect": "زبان را انتخاب کنید",
                    "securityGuideTitle": "راهنمای امنیت دیجیتال"
                },
                en: {
                    "title": "Random Key Generator",
                    "lengthLabel": "Key Length:",
                    "uppercaseLabel": "Uppercase (A-Z)",
                    "lowercaseLabel": "Lowercase (a-z)",
                    "numbersLabel": "Numbers (0-9)",
                    "symbolsLabel": "Special Symbols (!@#$%^&*_+-=`:.?)",
                    "autoCopyLabel": "Auto-copy key after generation",
                    "generateBtn": "Generate Key",
                    "copyBtn": "Copy",
                    "keyPlaceholder": "Key will appear here",
                    "strengthInfo": "Key Strength: Unknown",
                    "strengthWeak": "Key Strength: Weak",
                    "strengthMedium": "Key Strength: Medium",
                    "strengthGood": "Key Strength: Good",
                    "strengthExcellent": "Key Strength: Excellent",
                    "notificationSuccess": "Key copied successfully!",
                    "errorNoChars": "Please select at least one character type",
                    "errorLength": "Length must be between 4 and 512 characters",
                    "errorNoKey": "No key to copy",
                    "errorCopyFail": "Failed to copy key",
                    "languageSelect": "Select Language",
                    "securityGuideTitle": "Digital Security Guide"
                },
                fr: {
                    "title": "Générateur de Clés Aléatoires",
                    "lengthLabel": "Longueur de la Clé:",
                    "uppercaseLabel": "Majuscules (A-Z)",
                    "lowercaseLabel": "Minuscules (a-z)",
                    "numbersLabel": "Chiffres (0-9)",
                    "symbolsLabel": "Symboles Spéciaux (!@#$%^&*_+-=`:.?)",
                    "autoCopyLabel": "Copie automatique de la clé après génération",
                    "generateBtn": "Générer la Clé",
                    "copyBtn": "Copier",
                    "keyPlaceholder": "La clé apparaîtra ici",
                    "strengthInfo": "Force de la Clé: Inconnue",
                    "strengthWeak": "Force de la Clé: Faible",
                    "strengthMedium": "Force de la Clé: Moyenne",
                    "strengthGood": "Force de la Clé: Bonne",
                    "strengthExcellent": "Force de la Clé: Excellente",
                    "notificationSuccess": "Clé copiée avec succès!",
                    "errorNoChars": "Veuillez sélectionner au moins un type de caractère",
                    "errorLength": "La longueur doit être entre 4 et 512 caractères",
                    "errorNoKey": "Aucune clé à copier",
                    "errorCopyFail": "Échec de la copie de la clé",
                    "languageSelect": "Sélectionner la Langue",
                    "securityGuideTitle": "Guide de Sécurité Numérique"
                },
                zh: {
                    "title": "随机密钥生成器",
                    "lengthLabel": "密钥长度:",
                    "uppercaseLabel": "大写字母 (A-Z)",
                    "lowercaseLabel": "小写字母 (a-z)",
                    "numbersLabel": "数字 (0-9)",
                    "symbolsLabel": "特殊符号 (!@#$%^&*_+-=`:.?)",
                    "autoCopyLabel": "生成后自动复制密钥",
                    "generateBtn": "生成密钥",
                    "copyBtn": "复制",
                    "keyPlaceholder": "密钥将显示在这里",
                    "strengthInfo": "密钥强度: 未知",
                    "strengthWeak": "密钥强度: 弱",
                    "strengthMedium": "密钥强度: 中等",
                    "strengthGood": "密钥强度: 好",
                    "strengthExcellent": "密钥强度: 优秀",
                    "notificationSuccess": "密钥复制成功!",
                    "errorNoChars": "请至少选择一种字符类型",
                    "errorLength": "长度必须在4到512个字符之间",
                    "errorNoKey": "没有密钥可复制",
                    "errorCopyFail": "复制密钥失败",
                    "languageSelect": "选择语言",
                    "securityGuideTitle": "数字安全指南"
                },
                ru: {
                    "title": "Генератор Случайных Ключей",
                    "lengthLabel": "Длина Ключа:",
                    "uppercaseLabel": "Прописные буквы (A-Z)",
                    "lowercaseLabel": "Строчные буквы (a-z)",
                    "numbersLabel": "Цифры (0-9)",
                    "symbolsLabel": "Специальные символы (!@#$%^&*_+-=`:.?)",
                    "autoCopyLabel": "Автоматическое копирование ключа после генерации",
                    "generateBtn": "Сгенерировать Ключ",
                    "copyBtn": "Копировать",
                    "keyPlaceholder": "Ключ появится здесь",
                    "strengthInfo": "Прочность Ключа: Неизвестна",
                    "strengthWeak": "Прочность Ключа: Слабая",
                    "strengthMedium": "Прочность Ключа: Средняя",
                    "strengthGood": "Прочность Ключа: Хорошая",
                    "strengthExcellent": "Прочность Ключа: Отличная",
                    "notificationSuccess": "Ключ скопирован успешно!",
                    "errorNoChars": "Пожалуйста, выберите хотя бы один тип символов",
                    "errorLength": "Длина должна быть от 4 до 512 символов",
                    "errorNoKey": "Нет ключа для копирования",
                    "errorCopyFail": "Не удалось скопировать ключ",
                    "languageSelect": "Выбрать Язык",
                    "securityGuideTitle": "Руководство по Цифровой Безопасности"
                }
            };

            // تحميل الترجمات (يحاول أولاً تحميل ملف خارجي ثم ينسحب إلى المضمّن)
            async function loadTranslations(lang) {
                console.log(`Loading translations for ${lang}`);
                currentLang = lang;
                localStorage.setItem('selectedLang', lang); // حفظ اللغة

                // إذا كانت الصفحة مفتوحة محلياً عبر file:// فإن المتصفحات الحديثة تمنع fetch من ملفات محلية
                // لذلك نتجنّب محاولة جلب الملفات الخارجية ونستخدم الترجمات المضمّنة مباشرة
                if (location.protocol === 'file:' || location.origin === 'null') {
                    console.warn('Running from file:// — skipping external fetch (browser blocks local file requests). Using embedded translations.');
                    translations = translationFiles[lang] || translationFiles['ar'];
                    applyTranslations();
                    updateDirection();
                    return;
                }

                // محاولة جلب ملف الترجمة من المجلد `lang/` وملف خيارات اللغة
                try {
                    const [tResp, oResp] = await Promise.all([
                        fetch(`./lang/lang_${lang}.json`),
                        fetch(`./lang_options.json`)
                    ]);

                    if (tResp.ok) {
                        const external = await tResp.json();
                        // إذا نجحت القراءة، نستخدمها كأساس
                        translations = external;
                    } else {
                        console.warn(`Translation file not found for ${lang}, status:`, tResp.status);
                        translations = translationFiles[lang] || translationFiles['ar'];
                    }

                    if (oResp.ok) {
                        const opts = await oResp.json();
                        const options = opts[lang] || opts['ar'];
                        translations = { ...translations, ...options };
                    } else {
                        console.warn('lang_options.json not loaded, using defaults');
                    }
                } catch (err) {
                    console.warn('Failed to load external translation files, falling back to embedded translations.', err);
                    translations = translationFiles[lang] || translationFiles['ar'];
                }

                console.log('Loaded translations:', translations);
                applyTranslations();
                updateDirection();
            }

            // تطبيق الترجمات
            function applyTranslations() {
                document.querySelectorAll("[data-i18n]").forEach(el => {
                    const key = el.getAttribute("data-i18n");
                    const span = el.querySelector("span");
                    if (span) {
                        span.textContent = translations[key] || key;
                    } else {
                        el.textContent = translations[key] || key;
                    }
                });
                // تطبيق على title attributes
                document.querySelectorAll("[data-i18n-title]").forEach(el => {
                    const key = el.getAttribute("data-i18n-title");
                    el.setAttribute("title", translations[key] || key);
                });
            }

            // تحديث اتجاه النص
            function updateDirection() {
                const html = document.documentElement;
                const btn = document.querySelector('.security-guide-btn');
                if (currentLang === 'ar' || currentLang === 'fa') {
                    html.setAttribute('dir', 'rtl');
                    html.setAttribute('lang', currentLang);
                    btn.style.left = '20px';
                    btn.style.right = 'auto';
                } else {
                    html.setAttribute('dir', 'ltr');
                    html.setAttribute('lang', currentLang);
                    btn.style.right = '20px';
                    btn.style.left = 'auto';
                }
            }
            
            // مجموعة الأحرف الممكنة
            const uppercaseChars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            const lowercaseChars = 'abcdefghijklmnopqrstuvwxyz';
            const numberChars = '0123456789';
            const symbolChars = '!@#$%^&*_+-=`:.?';
            
            // توليد مفتاح عشوائي
            function generateKey() {
                let chars = '';
                let key = '';
                
                // بناء مجموعة الأحرف بناءً على الاختيارات
                if (uppercaseCheckbox.checked) chars += uppercaseChars;
                if (lowercaseCheckbox.checked) chars += lowercaseChars;
                if (numbersCheckbox.checked) chars += numberChars;
                if (symbolsCheckbox.checked) chars += symbolChars;
                
                // التأكد من اختيار نوع واحد على الأقل من الأحرف
                if (chars.length === 0) {
                    showNotification(translations.errorNoChars, true);
                    return;
                }
                
                const length = parseInt(lengthInput.value);
                
                // التأكد من أن الطول ضمن الحدود المسموحة
                if (length < 4 || length > 512) {
                    showNotification(translations.errorLength, true);
                    return;
                }
                
                // توليد المفتاح العشوائي
                key = '';
                if (window.crypto && window.crypto.getRandomValues) {
                    const randomValues = new Uint32Array(length);
                    window.crypto.getRandomValues(randomValues);

                    for (let i = 0; i < length; i++) {
                        key += chars[randomValues[i] % chars.length];
                    }
                } else {
                    // الطريقة التقليدية إذا لم يكن Crypto API متاحًا
                    for (let i = 0; i < length; i++) {
                        const randomIndex = Math.floor(Math.random() * chars.length);
                        key += chars[randomIndex];
                    }
                }

                // تعديل عدد الرموز الخاصة إذا تم اختيارها
                if (symbolsCheckbox.checked) {
                    let maxSpecial;
                    if (length < 64) {
                        maxSpecial = Math.max(1, Math.floor(length * 0.15)); // 15% للأطوال <64
                    } else if (length <= 128) {
                        maxSpecial = 4; // عدد ثابت 4 لـ 64-128
                    } else if (length <= 256) {
                        maxSpecial = 5; // عدد ثابت 5 لـ 128-256
                    } else {
                        maxSpecial = 10; // عدد ثابت 10 لـ >256
                    }

                    const specialPositions = [];
                    for (let i = 0; i < key.length; i++) {
                        if (/[^A-Za-z0-9]/.test(key[i])) specialPositions.push(i);
                    }
                    const specialCount = specialPositions.length;
                    const excess = specialCount - maxSpecial;
                    if (excess > 0) {
                        // استبدال الرموز الزائدة بحروف عادية
                        const nonSymbolChars = chars.replace(/[^A-Za-z0-9]/g, '');
                        const toReplace = specialPositions.sort(() => Math.random() - 0.5).slice(0, excess);
                        for (let pos of toReplace) {
                            key = key.substring(0, pos) + nonSymbolChars[Math.floor(Math.random() * nonSymbolChars.length)] + key.substring(pos + 1);
                        }
                    }
                }

                // عرض المفتاح
                keyElement.textContent = key;
                
                // حساب قوة المفتاح
                calculateStrength(key);
                
                // النسخ التلقائي إذا كان الخيار مفعل
                if (autoCopyCheckbox.checked) {
                    setTimeout(() => {
                        copyToClipboard();
                    }, 300);
                }
            }
            
            // حساب قوة المفتاح
            function calculateStrength(key) {
                let strength = 0;
                const length = key.length;
                
                // حساب القوة بناءً على الطول وتنوع الأحرف
                if (length >= 8) strength += 25;
                if (length >= 12) strength += 25;
                if (length >= 16) strength += 25;
                
                // التحقق من وجود أنواع مختلفة من الأحرف
                if (/[A-Z]/.test(key)) strength += 10;
                if (/[a-z]/.test(key)) strength += 10;
                if (/[0-9]/.test(key)) strength += 10;
                if (/[^A-Za-z0-9]/.test(key)) strength += 15;
                
                // التأكد من أن القوة لا تتجاوز 100%
                strength = Math.min(strength, 100);
                
                // تحديث مؤشر القوة
                strengthElement.style.width = strength + '%';
                
                // تحديث النص بناءً على القوة
                if (strength < 40) {
                    strengthElement.style.backgroundColor = '#e74c3c';
                    strengthInfoElement.textContent = translations.strengthWeak;
                } else if (strength < 70) {
                    strengthElement.style.backgroundColor = '#f39c12';
                    strengthInfoElement.textContent = translations.strengthMedium;
                } else if (strength < 90) {
                    strengthElement.style.backgroundColor = '#3498db';
                    strengthInfoElement.textContent = translations.strengthGood;
                } else {
                    strengthElement.style.backgroundColor = '#2ecc71';
                    strengthInfoElement.textContent = translations.strengthExcellent;
                }
            }
            
            // نسخ المفتاح إلى الحافظة
            async function copyToClipboard() {
                const key = keyElement.textContent;
                
                if (key === translations.keyPlaceholder) {
                    showNotification(translations.errorNoKey, true);
                    return;
                }
                
                // استخدام Clipboard API إذا كان متاحًا
                if (navigator.clipboard && window.isSecureContext) {
                    try {
                        await navigator.clipboard.writeText(key);
                        showNotification(translations.notificationSuccess);
                    } catch (err) {
                        console.error('Failed to copy: ', err);
                        // إذا فشل Clipboard API، نستخدم الطريقة القديمة
                        useFallbackCopyMethod(key);
                    }
                } else {
                    // استخدام الطريقة القديمة
                    useFallbackCopyMethod(key);
                }
            }
            
            // الطريقة البديلة للنسخ
            function useFallbackCopyMethod(text) {
                const textArea = document.createElement("textarea");
                textArea.value = text;
                textArea.style.position = "fixed";
                textArea.style.top = 0;
                textArea.style.left = 0;
                textArea.style.width = "2em";
                textArea.style.height = "2em";
                textArea.style.padding = 0;
                textArea.style.border = "none";
                textArea.style.outline = "none";
                textArea.style.boxShadow = "none";
                textArea.style.background = "transparent";
                
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                
                try {
                    const successful = document.execCommand('copy');
                    if (successful) {
                        showNotification(translations.notificationSuccess);
                    } else {
                        showNotification(translations.errorCopyFail, true);
                    }
                } catch (err) {
                    console.error('Failed to copy: ', err);
                    showNotification(translations.errorCopyFail, true);
                } finally {
                    document.body.removeChild(textArea);
                }
            }
            
            // إظهار إشعار للمستخدم
            function showNotification(message, isError = false) {
                notification.innerHTML = isError ? 
                    `<i class="fas fa-exclamation-circle"></i> ${message}` : 
                    `<i class="fas fa-check-circle"></i> ${message}`;
                
                notification.className = isError ? 'notification error' : 'notification';
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
            
            // إضافة معالجات الأحداث
            generateBtn.addEventListener('click', generateKey);
            copyBtn.addEventListener('click', copyToClipboard);
            languageSelect.addEventListener('change', (e) => {
                loadTranslations(e.target.value);
            });

            // تحميل الترجمات الأولية
            loadTranslations(currentLang);

            // تعيين اللغة المختارة في select
            document.getElementById('language-select').value = currentLang;

            // توليد مفتاح تلقائياً عند تحميل الصفحة
            generateKey();
        });
        // تحقق من الرابط الأول (Netlify) وإعادة التوجيه إذا لزم الأمر
        if (window.location.hostname !== 'mrt-alqaem-keygen.netlify.app') {
             fetch('https://mrt-alqaem-keygen.netlify.app/', { mode: 'no-cors' })
            .then(() => {
                // إذا نجح Netlify، أعد التوجيه إليه
                window.location.href = 'https://mrt-alqaem-keygen.netlify.app/';
            })
            .catch(() => {
            // إذا فشل، ابق على الرابط الحالي (GitHub Pages)
            console.log('Netlify غير متاح، البقاء على GitHub Pages');
            });
        }

    </script>
</body>
</html>