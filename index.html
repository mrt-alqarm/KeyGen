<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مولد المفاتيح العشوائية</title>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com;font-src https://cdnjs.cloudflare.com;font-src https://cdnjs.cloudflare.com;">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer">
    <style>*{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}body{background:linear-gradient(135deg,#6a11cb 0%,#2575fc 100%);color:#333;line-height:1.6;padding:20px;min-height:100vh;display:flex;justify-content:center;align-items:center}.container{max-width:800px;width:100%;margin:0 auto;background-color:rgba(255,255,255,.95);padding:30px;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,.2)}h1{text-align:center;margin-bottom:30px;color:#2c3e50;font-size:2.2rem;position:relative;padding-bottom:15px}h1::after{content:'';position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:100px;height:4px;background:linear-gradient(90deg,#6a11cb,#2575fc);border-radius:2px}.form-group{margin-bottom:20px}label{display:block;margin-bottom:8px;font-weight:bold;color:#2c3e50}input[type="number"]{width:100%;padding:12px 15px;border:2px solid #ddd;border-radius:6px;font-size:16px;transition:border-color .3s}input[type="number"]:focus{border-color:#3498db;outline:none}.checkbox-group{margin:12px 0;display:flex;align-items:center}.checkbox-group input[type="checkbox"]{margin-left:10px;width:18px;height:18px;cursor:pointer}.checkbox-group label{display:inline-block;margin-bottom:0;font-weight:normal;cursor:pointer}button{display:block;width:100%;padding:14px;background:linear-gradient(90deg,#3498db,#2980b9);color:white;border:none;border-radius:6px;cursor:pointer;font-size:18px;margin:25px 0;transition:transform .3s,box-shadow .3s;box-shadow:0 4px 10px rgba(52,152,219,.3)}button:hover{transform:translateY(-2px);box-shadow:0 6px 15px rgba(52,152,219,.4)}button:active{transform:translateY(0)}.result{margin-top:25px;padding:20px;background-color:#f8f9fa;border:2px solid #ddd;border-radius:8px;text-align:center;font-size:20px;word-break:break-all;position:relative;font-family:'Courier New',monospace;min-height:80px;display:flex;align-items:center;justify-content:center}.copy-btn{position:absolute;left:15px;top:50%;transform:translateY(-50%);background:linear-gradient(90deg,#7f8c8d,#95a5a6);padding:8px 15px;font-size:14px;width:auto;border-radius:6px;box-shadow:0 2px 5px rgba(0,0,0,.1)}.copy-btn:hover{background:linear-gradient(90deg,#95a5a6,#bdc3c7)}.strength-meter{height:12px;border-radius:6px;margin-top:15px;background-color:#eee;overflow:hidden}.strength-fill{height:100%;border-radius:6px;width:0%;transition:width .5s ease-in-out}.info{margin-top:10px;font-size:14px;color:#7f8c8d;text-align:center}.notification{position:fixed;top:20px;left:50%;transform:translateX(-50%);background-color:#2ecc71;color:white;padding:15px 25px;border-radius:8px;box-shadow:0 5px 15px rgba(0,0,0,.2);opacity:0;transition:opacity .3s,top .3s;z-index:1000;display:flex;align-items:center}.notification.error{background-color:#e74c3c}.notification.show{opacity:1;top:30px}.notification i{margin-left:10px}.auto-copy{display:flex;align-items:center;margin-top:10px}.auto-copy input{margin-left:10px}@media (max-width:600px){.container{padding:20px}h1{font-size:1.8rem}.result{font-size:16px;padding:15px 15px 15px 60px}.copy-btn{left:10px;padding:6px 12px;font-size:12px}.notification{width:90%;text-align:center}}</style>
</head>
<body>
    <div class="container"><h1>مولد المفاتيح العشوائية</h1><div class="form-group"><label for="length">طول المفتاح:</label><input type="number" id="length" min="4" max="265" value="16"></div><div class="form-group"><label>أنواع الأحرف:</label><div class="checkbox-group"><input type="checkbox" id="uppercase" checked><label for="uppercase">أحرف كبيرة (A-Z)</label></div><div class="checkbox-group"><input type="checkbox" id="lowercase" checked><label for="lowercase">أحرف صغيرة (a-z)</label></div><div class="checkbox-group"><input type="checkbox" id="numbers" checked><label for="numbers">أرقام (0-9)</label></div><div class="checkbox-group"><input type="checkbox" id="symbols"><label for="symbols">رموز خاصة (!@#$%^&*_+-=`:.?)</label></div></div><div class="auto-copy"><input type="checkbox" id="auto-copy" checked><label for="auto-copy">النسخ التلقائي للمفتاح بعد التوليد</label></div><button id="generate"><i class="fas fa-key"></i> توليد مفتاح</button><div class="result"><span id="key">سيظهر المفتاح هنا</span><button class="copy-btn" id="copy"><i class="fas fa-copy"></i> نسخ</button></div><div class="strength-meter"><div class="strength-fill" id="strength"></div></div><div class="info" id="strength-info">قوة المفتاح: غير معروف</div></div>

    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i> تم نسخ المفتاح بنجاح!
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const generateBtn = document.getElementById('generate');
            const copyBtn = document.getElementById('copy');
            const keyElement = document.getElementById('key');
            const lengthInput = document.getElementById('length');
            const uppercaseCheckbox = document.getElementById('uppercase');
            const lowercaseCheckbox = document.getElementById('lowercase');
            const numbersCheckbox = document.getElementById('numbers');
            const symbolsCheckbox = document.getElementById('symbols');
            const strengthElement = document.getElementById('strength');
            const strengthInfoElement = document.getElementById('strength-info');
            const notification = document.getElementById('notification');
            const autoCopyCheckbox = document.getElementById('auto-copy');
            
            // مجموعة الأحرف الممكنة
            const uppercaseChars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            const lowercaseChars = 'abcdefghijklmnopqrstuvwxyz';
            const numberChars = '0123456789';
            const symbolChars = '!@#$%^&*_+-=`:.?';
            
            // توليد مفتاح عشوائي
            function generateKey() {
                let chars = '';
                let key = '';
                
                // بناء مجموعة الأحرف بناءً على الاختيارات
                if (uppercaseCheckbox.checked) chars += uppercaseChars;
                if (lowercaseCheckbox.checked) chars += lowercaseChars;
                if (numbersCheckbox.checked) chars += numberChars;
                if (symbolsCheckbox.checked) chars += symbolChars;
                
                // التأكد من اختيار نوع واحد على الأقل من الأحرف
                if (chars.length === 0) {
                    showNotification('الرجاء اختيار نوع واحد على الأقل من الأحرف', true);
                    return;
                }
                
                const length = parseInt(lengthInput.value);
                
                // التأكد من أن الطول ضمن الحدود المسموحة
                if (length < 4 || length > 265) {
                    showNotification('الطول يجب أن يكون بين 4 و 265 حرفاً', true);
                    return;
                }
                
                // توليد المفتاح العشوائي
                key = '';
                if (window.crypto && window.crypto.getRandomValues) {
                    const randomValues = new Uint32Array(length);
                    window.crypto.getRandomValues(randomValues);

                    for (let i = 0; i < length; i++) {
                        key += chars[randomValues[i] % chars.length];
                    }
                } else {
                    // الطريقة التقليدية إذا لم يكن Crypto API متاحًا
                    for (let i = 0; i < length; i++) {
                        const randomIndex = Math.floor(Math.random() * chars.length);
                        key += chars[randomIndex];
                    }
                }

                // تعديل عدد الرموز الخاصة إذا تم اختيارها
                if (symbolsCheckbox.checked) {
                    let maxSpecial;
                    if (length < 64) {
                        maxSpecial = Math.max(1, Math.floor(length * 0.15)); // 15% للأطوال <64
                    } else if (length <= 128) {
                        maxSpecial = 4; // عدد ثابت 4 لـ 64-128
                    } else if (length <= 256) {
                        maxSpecial = 5; // عدد ثابت 5 لـ 128-256
                    } else {
                        maxSpecial = 10; // عدد ثابت 10 لـ >256
                    }

                    const specialPositions = [];
                    for (let i = 0; i < key.length; i++) {
                        if (/[^A-Za-z0-9]/.test(key[i])) specialPositions.push(i);
                    }
                    const specialCount = specialPositions.length;
                    const excess = specialCount - maxSpecial;
                    if (excess > 0) {
                        // استبدال الرموز الزائدة بحروف عادية
                        const nonSymbolChars = chars.replace(/[^A-Za-z0-9]/g, '');
                        const toReplace = specialPositions.sort(() => Math.random() - 0.5).slice(0, excess);
                        for (let pos of toReplace) {
                            key = key.substring(0, pos) + nonSymbolChars[Math.floor(Math.random() * nonSymbolChars.length)] + key.substring(pos + 1);
                        }
                    }
                }

                // عرض المفتاح
                keyElement.textContent = key;
                
                // حساب قوة المفتاح
                calculateStrength(key);
                
                // النسخ التلقائي إذا كان الخيار مفعل
                if (autoCopyCheckbox.checked) {
                    setTimeout(() => {
                        copyToClipboard();
                    }, 300);
                }
            }
            
            // حساب قوة المفتاح
            function calculateStrength(key) {
                let strength = 0;
                const length = key.length;
                
                // حساب القوة بناءً على الطول وتنوع الأحرف
                if (length >= 8) strength += 25;
                if (length >= 12) strength += 25;
                if (length >= 16) strength += 25;
                
                // التحقق من وجود أنواع مختلفة من الأحرف
                if (/[A-Z]/.test(key)) strength += 10;
                if (/[a-z]/.test(key)) strength += 10;
                if (/[0-9]/.test(key)) strength += 10;
                if (/[^A-Za-z0-9]/.test(key)) strength += 15;
                
                // التأكد من أن القوة لا تتجاوز 100%
                strength = Math.min(strength, 100);
                
                // تحديث مؤشر القوة
                strengthElement.style.width = strength + '%';
                
                // تحديد لون المؤشر بناءً على القوة
                if (strength < 40) {
                    strengthElement.style.backgroundColor = '#e74c3c';
                    strengthInfoElement.textContent = 'قوة المفتاح: ضعيف';
                } else if (strength < 70) {
                    strengthElement.style.backgroundColor = '#f39c12';
                    strengthInfoElement.textContent = 'قوة المفتاح: متوسط';
                } else if (strength < 90) {
                    strengthElement.style.backgroundColor = '#3498db';
                    strengthInfoElement.textContent = 'قوة المفتاح: جيد';
                } else {
                    strengthElement.style.backgroundColor = '#2ecc71';
                    strengthInfoElement.textContent = 'قوة المفتاح: ممتاز';
                }
            }
            
            // نسخ المفتاح إلى الحافظة
            async function copyToClipboard() {
                const key = keyElement.textContent;
                
                if (key === 'سيظهر المفتاح هنا') {
                    showNotification('لا يوجد مفتاح لنسخه', true);
                    return;
                }
                
                // استخدام Clipboard API إذا كان متاحًا
                if (navigator.clipboard && window.isSecureContext) {
                    try {
                        await navigator.clipboard.writeText(key);
                        showNotification('تم نسخ المفتاح بنجاح!');
                    } catch (err) {
                        console.error('Failed to copy: ', err);
                        // إذا فشل Clipboard API، نستخدم الطريقة القديمة
                        useFallbackCopyMethod(key);
                    }
                } else {
                    // استخدام الطريقة القديمة
                    useFallbackCopyMethod(key);
                }
            }
            
            // الطريقة البديلة للنسخ
            function useFallbackCopyMethod(text) {
                const textArea = document.createElement("textarea");
                textArea.value = text;
                textArea.style.position = "fixed";
                textArea.style.top = 0;
                textArea.style.left = 0;
                textArea.style.width = "2em";
                textArea.style.height = "2em";
                textArea.style.padding = 0;
                textArea.style.border = "none";
                textArea.style.outline = "none";
                textArea.style.boxShadow = "none";
                textArea.style.background = "transparent";
                
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                
                try {
                    const successful = document.execCommand('copy');
                    if (successful) {
                        showNotification('تم نسخ المفتاح بنجاح!');
                    } else {
                        showNotification('فشل في نسخ المفتاح', true);
                    }
                } catch (err) {
                    console.error('Failed to copy: ', err);
                    showNotification('فشل في نسخ المفتاح', true);
                } finally {
                    document.body.removeChild(textArea);
                }
            }
            
            // إظهار إشعار للمستخدم
            function showNotification(message, isError = false) {
                notification.innerHTML = isError ? 
                    `<i class="fas fa-exclamation-circle"></i> ${message}` : 
                    `<i class="fas fa-check-circle"></i> ${message}`;
                
                notification.className = isError ? 'notification error' : 'notification';
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
            
            // إضافة معالجات الأحداث
            generateBtn.addEventListener('click', generateKey);
            copyBtn.addEventListener('click', copyToClipboard);
            
            // توليد مفتاح تلقائياً عند تحميل الصفحة
            generateKey();
        });
    </script>
</body>
</html>
